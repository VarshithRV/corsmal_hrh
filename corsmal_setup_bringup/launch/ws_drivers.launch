<?xml version="1.0"?>
<launch>
    <arg name="calibrate_system" default="false"/> <!--set true to calibrate the system-->
    

    <include file="$(find corsmal_setup_bringup)/launch/ur16e.launch"/> <!--substitute with ur5e.launch if using ur5e-->
    <include file="$(find corsmal_setup_bringup)/launch/azuredk_left.launch"/>
    <include file="$(find realsense2_camera)/launch/rs_aligned_depth.launch">
        <arg name="camera" default="collocated_camera"/>
    </include>
    <group if="$(arg calibrate_system)">
        <group ns="left_camera">
            <include file="$(find aruco_proxy_pose_estimation)/launch/apriltag_grid_detector.launch">
                <arg name="config_file" value="$(find corsmal_setup_bringup)/config/apriltag_grid_detector_config_left_azure.yaml"/>
            </include>
        </group>
        <group ns="collocated_camera">
            <include file="$(find aruco_proxy_pose_estimation)/launch/apriltag_grid_detector.launch">
                <arg name="config_file" value="$(find corsmal_setup_bringup)/config/apriltag_grid_detector_config_collocated_realsense.yaml"/>
            </include>
        </group>
        <group ns="left_camera">
            <include file="$(find aruco_proxy_pose_estimation)/launch/apriltag_grid_detector.launch">
                <arg name="config_file" value="$(find corsmal_setup_bringup)/config/apriltag_grid_detector_config_left_azure.yaml"/>
            </include>
        </group>
    </group>
    <node pkg="corsmal_setup_bringup" type="calibration_publisher_robot.py" name="robot_calibration_publisher" /> <!--calibration for robot-->
    <node pkg="corsmal_setup_bringup" type="extrinsic_publisher_azure_left.py" name="extrinsic_publisher_azure_left" /> <!--calibration for left camera-->
    <node pkg="tf" type="static_transform_publisher" name="wrist3_to_camera_tf" args="0.02 0.099 0.016 0.5 0.5 0.5 -0.5 wrist_3_link camera_link 50" /> <!--calibration for collocated camera-->
    <include file="$(find aruco_proxy_pose_estimation)/launch/proxy_object_detector.launch"/>
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find corsmal_setup_bringup)/config/default.rviz" />
</launch>